labs(x = "Région", y = "Fréquence") +
theme_bw() + theme(axis.text.x = element_text(angle = 20))
ggplot.premfreqperyear <- ggplot(data, aes(x = prem_freqperyear))+
geom_bar() + theme_bw() + ggtitle("(1)") + theme(axis.text.x = element_text(angle = 90))
ggplot.vehicl_garage <- ggplot(data, aes(x = vehicl_garage))+
geom_bar() + theme_bw() + ggtitle("(2)") + theme(axis.text.x = element_text(angle = 90))
grid.arrange(ggplot.premfreqperyear, ggplot.vehicl_garage,  ncol=2)
c1_avant <- gsub(" kW", "", levels(data.init$vehicl_powerkw))
c2_avant <- unname(summary(data.init$vehicl_powerkw))
c1_apres <- gsub(" kW", "", levels(data$vehicl_powerkw))
c2_apres <- unname(summary(data$vehicl_powerkw))
c1_avant
c3_avant <- as.numeric(c2_avant)
c3_avant
c3_avant <- round(as.numeric(c2_avant)/nrow(data), 4)
c3_avant
c1_avant <- gsub(" kW", "", levels(data.init$vehicl_powerkw))
c2_avant <- unname(summary(data.init$vehicl_powerkw))
c3_avant <- round(as.numeric(c2_avant)/nrow(data), 4)
c3_avant <- scales::percent(c3_avant, suffix =" \\%", accuracy = 0.01)
c1_apres <- gsub(" kW", "", levels(data$vehicl_powerkw))
c2_apres <- unname(summary(data$vehicl_powerkw))
c3_apres <- round(as.numeric(c2_apres)/nrow(data), 4)
c3_apres <- scales::percent(c3_apres, suffix =" \\%", accuracy = 0.01)
tableau_powerkw_avant <- cbind(c1_avant, c2_avant, c3_avant)
tableau_powerkw_apres <- cbind(c1_apres, c2_apres, c3_apres)
tab_avant <- as.data.frame(tableau_powerkw_avant)
tab_apres <- as.data.frame(tableau_powerkw_apres)
colnames(tab_avant) <- c("Puissance (kW)", "Nombre d'observation", "Distribution")
colnames(tab_apres) <- c("Puissance (kW)", "Nombre d'observation", "Distribution")
t1 <- kable(tab_avant, format = "latex", align = c("c", "c", "r"), booktabs = TRUE)
t2 <- kable(tab_apres, format = "latex", align = c("c", "c", "r"),  booktabs = TRUE)
cat(c("\\begin{table}[!htb]
\\begin{minipage}{.5\\linewidth}
\\caption{Distribution de la variable Vehicl_powerkw pour chacune des catégories (avant modification)}
\\centering",
t1,
"\\end{minipage}%
\\begin{minipage}{.5\\linewidth}
\\centering
\\caption{Distribution de la variable Vehicl_powerkw pour chacune des catégories (après modification)}",
t2,
"\\end{minipage}
\\end{table}"
))
library(CASdatasets)
library(knitr)
library(tidyverse)
library(mice)
library(xtable)
library(reshape2)
library(VIM)
library(gridExtra)
library(grid)
library(lattice)
require(FactoMineR)
require(factoextra)
require(plotly)
library(cluster)
require(scale)
data(eudirectlapse)
data.init <- eudirectlapse
## Changement dans les donnees
data <- data.init
# Changement des 0 et 1 de lapse en renouvellement et resignation
data$lapse <- as.factor(data$lapse)
levels(data$lapse) <- c("renouvellement", "resignation")
# Changment des valeurs unknown en NA des variables:
# polholder_diffdriver, vehicl_garage et policy_caruse
data[data$polholder_diffdriver == "unknown", ]$polholder_diffdriver <- NA
data[data$vehicl_garage == "unknown", ]$vehicl_garage <- NA
data[data$policy_caruse == "unknown", ]$policy_caruse <- NA
# Reordonnement de la variable prem_freqperyear en facteur ordonnée (ordinal)
data$prem_freqperyear <- factor(data$prem_freqperyear, order = TRUE, levels = c("1 per year", "2 per year", "4 per year", "12 per year"))
# Regions
data$vehicl_region <- factor(data$vehicl_region, order = TRUE, levels = c("Reg1", "Reg2", "Reg3", "Reg4", "Reg5", "Reg6", "Reg7", "Reg8", "Reg9", "Reg10", "Reg11", "Reg12", "Reg13", "Reg14"))
# Creation d un nouvelle variable prem_index=prem_final/prem_last
data$prem_index <- data$prem_final / data$prem_last - 1
# Traitement de la variable vehicl_powerkw: regroupement en 4 groupe
#data$vehicl_powerkw_na <- data$vehicl_powerkw
#data[data$vehicl_powerkw_na == "125-300 kW", ]$vehicl_powerkw_na <- NA
data[data$vehicl_powerkw %in% c("150 kW","175 kW","200 kW","225 kW","250 kW","275 kW","300 kW"), ]$vehicl_powerkw <- "125-300 kW"
data <- droplevels(data)
data$vehicl_powerkw <- factor(data$vehicl_powerkw, order = TRUE, levels = c("25-50 kW", "75 kW", "100 kW", "125-300 kW"))
table(data$vehicl_powerkw)
print.tables <- function(dat, caption="", label="", align=rep("c", ncol(dat)+1), digits=3, ...){
print(xtable(dat, digits = digits,
caption=caption,
label=label,
align=align),
include.rownames = FALSE, sanitize.text.function=function(x){x},
caption.placement = "top", comment=FALSE, ...)
}
knitr::opts_chunk$set(echo = TRUE)
l1 <- c(summary(data$polholder_diffdriver)[c("all drivers > 24")])
l2 <- c(summary(data$polholder_diffdriver)[c("commercial")])
l3 <- c(summary(data$polholder_diffdriver)[c("learner 17")])
l4 <- c(summary(data$polholder_diffdriver)[c("only partner")])
l5 <- c(summary(data$polholder_diffdriver)[c("same")])
l6 <- c(summary(data$polholder_diffdriver)[c("young drivers")])
l7 <- c(summary(data$polholder_diffdriver)[c("NA's")])
ligne_name <- c("Conducteurs agée de 24+","Commerciale","Conducteur apprenti de 17 ans","Partenaire de couple", "Utilisateur seul", "Jeunes utilisateurs", "Données manquantes")
dist <- round(as.vector(rbind(l1 , l2, l3, l4, l5, l6, l7)/nrow(data)), 4)
tableau_statut <- cbind(ligne_name ,rbind(l1 , l2, l3, l4, l5, l6, l7), scales::percent(dist, suffix =" \\%", accuracy = 0.01))
dat_frame_tab <- as.data.frame(tableau_statut)
colnames(dat_frame_tab) <- c("Statut", "Nombre d'observation", "Distribution")
print.tables(dat_frame_tab, hline.after=c(-1,0,7), digits=2, align = c("l", "l", "c", "r"),
caption="Distribution de la différence de statut entre le conducteur et le détenteur de la police", label="tbl:statutdiff")
p1 <- summary(data$polholder_gender)[c("Male")]
p2 <- summary(data$polholder_gender)[c("Female")]
ligne_name <- c("Homme", "Femme")
dist <- round(as.vector(rbind(p1, p2)/nrow(data)), 4)
tableau_sexe <- cbind(ligne_name ,rbind(p1 , p2), scales::percent(dist, suffix =" \\%", accuracy = 0.01))
dat_frame_tab <- as.data.frame(tableau_sexe)
colnames(dat_frame_tab) <- c("Sexe", "Nombre d'observation", "Distribution")
print.tables(dat_frame_tab, hline.after=c(-1,0,2), digits=2,
align = c("l", "l", "c", "r"),
caption="Distribution du sexe du détenteur de police",
label="tbl:polholderGender")
l1 <- c(summary(data$policy_caruse)[c("commercial")])
l2 <- c(summary(data$policy_caruse)[c("private or freelance work")])
l3 <- c(summary(data$policy_caruse)[c("NA's")])
dist <- round(as.vector(rbind(l1, l2, l3)/nrow(data)), 4)
ligne_name <- c("Commerciale","Privé ou aller travailler","Données manquantes")
tableau_caruse <- cbind(ligne_name ,rbind(l1 , l2, l3), scales::percent(dist, suffix =" \\%", accuracy = 0.01))
dat_frame_tab3 <- as.data.frame(tableau_caruse)
colnames(dat_frame_tab3) <- c("Usage", "Nombre d'observation", "Distribution")
print.tables(dat_frame_tab3, digits=2,
align = c("l", "l", "c", "r"),
caption="Distribution de l'utilisation du véhicule",
label="tbl:policyCaruse")
l1 <- c(summary(data$vehicl_garage)[c("carport")])
l2 <- c(summary(data$vehicl_garage)[c("parking deck")])
l3 <- c(summary(data$vehicl_garage)[c("private estate")])
l4 <- c(summary(data$vehicl_garage)[c("private garage")])
l5 <- c(summary(data$vehicl_garage)[c("street")])
l6 <- c(summary(data$vehicl_garage)[c("underground garage")])
l7 <- c(summary(data$vehicl_garage)[c("other")])
l8 <- c(summary(data$vehicl_garage)[c("NA's")])
dist <- round(as.vector(rbind(l1, l2, l3, l4, l5, l6, l7, l8)/nrow(data)), 4)
ligne_name <- c("Sous un abri d'auto", "Terrase de stationnement", "Stationnement privé", "Garage", "Rue", "Garage sous-terrain", "Autre", "Données manquantes")
tableau_garage <- cbind(ligne_name ,rbind(l1 , l2, l3, l4, l5, l6, l7, l8), scales::percent(dist, suffix =" \\%", accuracy = 0.01))
dat_frame_tab4 <- as.data.frame(tableau_garage)
colnames(dat_frame_tab4) <- c("Moyen de stationnement", "Nombre d'observation", "Distribution")
print.tables(dat_frame_tab4, digits=2,
align = c("l", "l", "c", "r"),
caption="Distribution du type de stationnement",
label="tbl:policyGarage")
l1 <- c(summary(data$polholder_BMCevol)[c("up")])
l2 <- c(summary(data$polholder_BMCevol)[c("stable")])
l3 <- c(summary(data$polholder_BMCevol)[c("down")])
dist <- round(as.vector(rbind(l1, l2, l3)/nrow(data)), 4)
ligne_name <- c("Hausse", "Inchangée", "Baisse")
tableau_BM <- cbind(ligne_name ,rbind(l1 , l2, l3), scales::percent(dist, suffix =" \\%", accuracy = 0.01))
dat_frame_tab5 <- as.data.frame(tableau_BM)
colnames(dat_frame_tab5) <- c("Prime de renouvellement", "Nombre d'observation", "Distribution")
print.tables(dat_frame_tab5, digits=2,
align = c("l", "l", "c", "r"),
caption="Distribution de l'indice Bonus-Malus",
label="tbl:policyBM")
ggplot(data, aes(x = vehicl_region))+
geom_bar() +
labs(x = "Région", y = "Fréquence") +
theme_bw() + theme(axis.text.x = element_text(angle = 20))
ggplot.premfreqperyear <- ggplot(data, aes(x = prem_freqperyear))+
geom_bar() + theme_bw() + ggtitle("(1)") + theme(axis.text.x = element_text(angle = 90))
ggplot.vehicl_garage <- ggplot(data, aes(x = vehicl_garage))+
geom_bar() + theme_bw() + ggtitle("(2)") + theme(axis.text.x = element_text(angle = 90))
grid.arrange(ggplot.premfreqperyear, ggplot.vehicl_garage,  ncol=2)
c1_avant <- gsub(" kW", "", levels(data.init$vehicl_powerkw))
c2_avant <- unname(summary(data.init$vehicl_powerkw))
c3_avant <- round(as.numeric(c2_avant)/nrow(data), 4)
c3_avant <- scales::percent(c3_avant, suffix =" \\%", accuracy = 0.01)
c1_apres <- gsub(" kW", "", levels(data$vehicl_powerkw))
c2_apres <- unname(summary(data$vehicl_powerkw))
c3_apres <- round(as.numeric(c2_apres)/nrow(data), 4)
c3_apres <- scales::percent(c3_apres, suffix =" \\%", accuracy = 0.01)
tableau_powerkw_avant <- cbind(c1_avant, c3_avant)
tableau_powerkw_apres <- cbind(c1_apres, c3_apres)
tab_avant <- as.data.frame(tableau_powerkw_avant)
tab_apres <- as.data.frame(tableau_powerkw_apres)
colnames(tab_avant) <- c("Puissance (kW)", "Distribution")
colnames(tab_apres) <- c("Puissance (kW)", "Distribution")
t1 <- kable(tab_avant, format = "latex", align = c("c", "r"), booktabs = TRUE)
t2 <- kable(tab_apres, format = "latex", align = c("c", "r"),  booktabs = TRUE)
t1
tab_avant
t1 <- kable(tab_avant, format = "latex", align = c("c", "r"), booktabs = TRUE)
t1
print.tables(t1, digits=2,
align = c("l", "l", "c", "r"),
caption="",
label="")
print.tables(tab_avant, digits=2,
align = c("l", "l", "c", "r"),
caption="",
label="")
c1_avant <- gsub(" kW", "", levels(data.init$vehicl_powerkw))
c2_avant <- unname(summary(data.init$vehicl_powerkw))
c1_apres <- gsub(" kW", "", levels(data$vehicl_powerkw))
c2_apres <- unname(summary(data$vehicl_powerkw))
c3_apres <- round(as.numeric(c2_apres)/nrow(data), 4)
c3_apres <- scales::percent(c3_apres, suffix =" \\%", accuracy = 0.01)
tableau_powerkw_avant <- cbind(c1_avant, c2_avant, c3_avant)
tableau_powerkw_apres <- cbind(c1_apres, c2_apres, c3_apres)
tab_avant <- as.data.frame(tableau_powerkw_avant)
tab_apres <- as.data.frame(tableau_powerkw_apres)
print.tables(tab_avant, digits=2,
align = c("l", "l", "c", "r"),
caption="",
label="")
print.tables(cbind(tab_avant, tab_apres) , digits=2,
align = c("l", "l", "c", "r"),
caption="",
label="")
cbind(tab_avant, tab_apres)
cbind(tab_avant, tab_apres)
tab_apres
print.tables(rbind(tab_avant, tab_apres) , digits=2,
align = c("l", "l", "c", "r"),
caption="",
label="")
colnames(tab_avant) <- c("Puissance (kW)", "Nombre d'observation", "Distribution")
colnames(tab_apres) <- c("Puissance (kW)", "Nombre d'observation","Distribution")
t2 <- kable(tab_apres, format = "latex", align = c("c", "r"),  booktabs = TRUE)
cat(c("\\begin{table}[!htb]
\\begin{minipage}{.5\\linewidth}
\\caption{Distribution de la variable Vehicl_powerkw pour chacune des catégories (avant modification)}
\\centering",
t1,
"\\end{minipage}%
\\begin{minipage}{.5\\linewidth}
\\centering
\\caption{Distribution de la variable Vehicl_powerkw pour chacune des catégories (après modification)}",
t2,
"\\end{minipage}
\\end{table}"
))
print.tables(rbind(tab_avant, tab_apres) , digits=2,
align = c("l", "l", "c", "r"),
caption="",
label="")
print.tables(rbind(tab_avant, tab_apres) , digits=2,
align = c("l", "l", "c", "r"),
caption="",
label="",
hline.after=c(-1,0,7))
print.tables(rbind(tab_avant, tab_apres) , digits=2,
align = c("l", "l", "c", "r"),
caption="",
label="",
hline.after=c(-1,0,9))
print.tables(rbind(tab_avant, tab_apres) , digits=2,
align = c("l", "l", "c", "r"),
caption="",
label="",
hline.after=c(-1,0,10))
print.tables(rbind(tab_avant, tab_apres) , digits=2,
align = c("l", "l", "c", "r"),
caption="",
label="",
hline.after=c(-1,0,10, 15))
ggplot(data, aes(x=prem_last, y=prem_final)) +
geom_point()
ggplot(data, aes(x=prem_last, y=prem_final, col=lapse)) +
geom_point()
ggplot(data, aes(x=lapse, y=prem_index)) +
geom_boxplot()
ggplot(data, aes(x=lapse, y=1+prem_index)) +
geom_boxplot()
ggplot(data, aes(x=lapse, y=prem_index)) +
geom_boxplot()
ggplot(data, aes(x=lapse, y=100*prem_index)) +
geom_boxplot()
data$prem_index
round(data$prem_index, 4)
str(data)
contrib <- data.frame(ACP$var$coord[,1:2])
library(CASdatasets)
library(knitr)
library(tidyverse)
library(mice)
library(xtable)
library(reshape2)
library(VIM)
library(gridExtra)
library(grid)
library(lattice)
require(FactoMineR)
require(factoextra)
require(plotly)
library(cluster)
require(scale)
data(eudirectlapse)
data.init <- eudirectlapse
## Changement dans les donnees
data <- data.init
# Changement des 0 et 1 de lapse en renouvellement et resignation
data$lapse <- as.factor(data$lapse)
levels(data$lapse) <- c("renouvellement", "resignation")
# Changment des valeurs unknown en NA des variables:
# polholder_diffdriver, vehicl_garage et policy_caruse
data[data$polholder_diffdriver == "unknown", ]$polholder_diffdriver <- NA
data[data$vehicl_garage == "unknown", ]$vehicl_garage <- NA
data[data$policy_caruse == "unknown", ]$policy_caruse <- NA
# Reordonnement de la variable prem_freqperyear en facteur ordonnée (ordinal)
data$prem_freqperyear <- factor(data$prem_freqperyear, order = TRUE, levels = c("1 per year", "2 per year", "4 per year", "12 per year"))
# Regions
data$vehicl_region <- factor(data$vehicl_region, order = TRUE, levels = c("Reg1", "Reg2", "Reg3", "Reg4", "Reg5", "Reg6", "Reg7", "Reg8", "Reg9", "Reg10", "Reg11", "Reg12", "Reg13", "Reg14"))
# Creation d un nouvelle variable prem_index=prem_final/prem_last
data$prem_index <- data$prem_final / data$prem_last - 1
# Traitement de la variable vehicl_powerkw: regroupement en 4 groupe
#data$vehicl_powerkw_na <- data$vehicl_powerkw
#data[data$vehicl_powerkw_na == "125-300 kW", ]$vehicl_powerkw_na <- NA
data[data$vehicl_powerkw %in% c("150 kW","175 kW","200 kW","225 kW","250 kW","275 kW","300 kW"), ]$vehicl_powerkw <- "125-300 kW"
data <- droplevels(data)
data$vehicl_powerkw <- factor(data$vehicl_powerkw, order = TRUE, levels = c("25-50 kW", "75 kW", "100 kW", "125-300 kW"))
table(data$vehicl_powerkw)
print.tables <- function(dat, caption="", label="", align=rep("c", ncol(dat)+1), digits=3, ...){
print(xtable(dat, digits = digits,
caption=caption,
label=label,
align=align),
include.rownames = FALSE, sanitize.text.function=function(x){x},
caption.placement = "top", comment=FALSE, ...)
}
knitr::opts_chunk$set(echo = TRUE)
l1 <- c(summary(data$polholder_diffdriver)[c("all drivers > 24")])
l2 <- c(summary(data$polholder_diffdriver)[c("commercial")])
l3 <- c(summary(data$polholder_diffdriver)[c("learner 17")])
l4 <- c(summary(data$polholder_diffdriver)[c("only partner")])
l5 <- c(summary(data$polholder_diffdriver)[c("same")])
l6 <- c(summary(data$polholder_diffdriver)[c("young drivers")])
l7 <- c(summary(data$polholder_diffdriver)[c("NA's")])
ligne_name <- c("Conducteurs agée de 24+","Commerciale","Conducteur apprenti de 17 ans","Partenaire de couple", "Utilisateur seul", "Jeunes utilisateurs", "Données manquantes")
dist <- round(as.vector(rbind(l1 , l2, l3, l4, l5, l6, l7)/nrow(data)), 4)
tableau_statut <- cbind(ligne_name ,rbind(l1 , l2, l3, l4, l5, l6, l7), scales::percent(dist, suffix =" \\%", accuracy = 0.01))
dat_frame_tab <- as.data.frame(tableau_statut)
colnames(dat_frame_tab) <- c("Statut", "Nombre d'observation", "Distribution")
print.tables(dat_frame_tab, hline.after=c(-1,0,7), digits=2, align = c("l", "l", "c", "r"),
caption="Distribution de la différence de statut entre le conducteur et le détenteur de la police", label="tbl:statutdiff")
p1 <- summary(data$polholder_gender)[c("Male")]
p2 <- summary(data$polholder_gender)[c("Female")]
ligne_name <- c("Homme", "Femme")
dist <- round(as.vector(rbind(p1, p2)/nrow(data)), 4)
tableau_sexe <- cbind(ligne_name ,rbind(p1 , p2), scales::percent(dist, suffix =" \\%", accuracy = 0.01))
dat_frame_tab <- as.data.frame(tableau_sexe)
colnames(dat_frame_tab) <- c("Sexe", "Nombre d'observation", "Distribution")
print.tables(dat_frame_tab, hline.after=c(-1,0,2), digits=2,
align = c("l", "l", "c", "r"),
caption="Distribution du sexe du détenteur de police",
label="tbl:polholderGender")
l1 <- c(summary(data$policy_caruse)[c("commercial")])
l2 <- c(summary(data$policy_caruse)[c("private or freelance work")])
l3 <- c(summary(data$policy_caruse)[c("NA's")])
dist <- round(as.vector(rbind(l1, l2, l3)/nrow(data)), 4)
ligne_name <- c("Commerciale","Privé ou aller travailler","Données manquantes")
tableau_caruse <- cbind(ligne_name ,rbind(l1 , l2, l3), scales::percent(dist, suffix =" \\%", accuracy = 0.01))
dat_frame_tab3 <- as.data.frame(tableau_caruse)
colnames(dat_frame_tab3) <- c("Usage", "Nombre d'observation", "Distribution")
print.tables(dat_frame_tab3, digits=2,
align = c("l", "l", "c", "r"),
caption="Distribution de l'utilisation du véhicule",
label="tbl:policyCaruse")
l1 <- c(summary(data$vehicl_garage)[c("carport")])
l2 <- c(summary(data$vehicl_garage)[c("parking deck")])
l3 <- c(summary(data$vehicl_garage)[c("private estate")])
l4 <- c(summary(data$vehicl_garage)[c("private garage")])
l5 <- c(summary(data$vehicl_garage)[c("street")])
l6 <- c(summary(data$vehicl_garage)[c("underground garage")])
l7 <- c(summary(data$vehicl_garage)[c("other")])
l8 <- c(summary(data$vehicl_garage)[c("NA's")])
dist <- round(as.vector(rbind(l1, l2, l3, l4, l5, l6, l7, l8)/nrow(data)), 4)
ligne_name <- c("Sous un abri d'auto", "Terrase de stationnement", "Stationnement privé", "Garage", "Rue", "Garage sous-terrain", "Autre", "Données manquantes")
tableau_garage <- cbind(ligne_name ,rbind(l1 , l2, l3, l4, l5, l6, l7, l8), scales::percent(dist, suffix =" \\%", accuracy = 0.01))
dat_frame_tab4 <- as.data.frame(tableau_garage)
colnames(dat_frame_tab4) <- c("Moyen de stationnement", "Nombre d'observation", "Distribution")
print.tables(dat_frame_tab4, digits=2,
align = c("l", "l", "c", "r"),
caption="Distribution du type de stationnement",
label="tbl:policyGarage")
l1 <- c(summary(data$polholder_BMCevol)[c("up")])
l2 <- c(summary(data$polholder_BMCevol)[c("stable")])
l3 <- c(summary(data$polholder_BMCevol)[c("down")])
dist <- round(as.vector(rbind(l1, l2, l3)/nrow(data)), 4)
ligne_name <- c("Hausse", "Inchangée", "Baisse")
tableau_BM <- cbind(ligne_name ,rbind(l1 , l2, l3), scales::percent(dist, suffix =" \\%", accuracy = 0.01))
dat_frame_tab5 <- as.data.frame(tableau_BM)
colnames(dat_frame_tab5) <- c("Prime de renouvellement", "Nombre d'observation", "Distribution")
print.tables(dat_frame_tab5, digits=2,
align = c("l", "l", "c", "r"),
caption="Distribution de l'indice Bonus-Malus",
label="tbl:policyBM")
ggplot(data, aes(x = vehicl_region))+
geom_bar() +
labs(x = "Région", y = "Fréquence") +
theme_bw() + theme(axis.text.x = element_text(angle = 20))
ggplot.premfreqperyear <- ggplot(data, aes(x = prem_freqperyear))+
geom_bar() + theme_bw() + ggtitle("(1)") + theme(axis.text.x = element_text(angle = 90))
ggplot.vehicl_garage <- ggplot(data, aes(x = vehicl_garage))+
geom_bar() + theme_bw() + ggtitle("(2)") + theme(axis.text.x = element_text(angle = 90))
grid.arrange(ggplot.premfreqperyear, ggplot.vehicl_garage,  ncol=2)
c1_avant <- gsub(" kW", "", levels(data.init$vehicl_powerkw))
c2_avant <- unname(summary(data.init$vehicl_powerkw))
c3_avant <- round(as.numeric(c2_avant)/nrow(data), 4)
c3_avant <- scales::percent(c3_avant, suffix =" \\%", accuracy = 0.01)
c1_apres <- gsub(" kW", "", levels(data$vehicl_powerkw))
c2_apres <- unname(summary(data$vehicl_powerkw))
c3_apres <- round(as.numeric(c2_apres)/nrow(data), 4)
c3_apres <- scales::percent(c3_apres, suffix =" \\%", accuracy = 0.01)
tableau_powerkw_avant <- cbind(c1_avant, c2_avant, c3_avant)
tableau_powerkw_apres <- cbind(c1_apres, c2_apres, c3_apres)
tab_avant <- as.data.frame(tableau_powerkw_avant)
tab_apres <- as.data.frame(tableau_powerkw_apres)
colnames(tab_avant) <- c("Puissance (kW)", "Nombre d'observation", "Distribution")
colnames(tab_apres) <- c("Puissance (kW)", "Nombre d'observation","Distribution")
print.tables(rbind(tab_avant, tab_apres) , digits=2,
align = c("l", "l", "c", "r"),
caption="Distribution de la puissance du moteur avant et après modification",
label="",
hline.after=c(-1,0,10, 15))
ggplot(data, aes(x = polholder_age))+
geom_bar() +
labs(x = "Âge du détenteur de police", y = "Fréquence") +
theme_bw() + facet_grid(~polholder_gender)
ggplot(data, aes(x = policy_age))+
geom_bar() +
labs(x = "Âge de la police", y = "Fréquence") +
theme_bw()
ggplot(data, aes(x = policy_nbcontract))+
geom_bar() +
labs(x = "Nombre de contrat par police", y = "Fréquence") +
theme_bw()
agepurchase_vehicule <- ggplot(data, aes(x = vehicl_agepurchase))+
geom_bar() + theme_bw() + ggtitle("(1)")
age_vehicule <- ggplot(data, aes(x = vehicl_age))+
geom_bar()+ theme_bw() + ggtitle("(2)")
grid.arrange(agepurchase_vehicule, age_vehicule,  ncol=2)
stats_final <- c(summary(data$prem_final)[c(1, 3, 4, 6)], sd(data$prem_final))
stats_last <- c(summary(data$prem_last)[c(1, 3, 4, 6)], sd(data$prem_last))
stats_market <- c(summary(data$prem_market)[c(1, 3, 4, 6)], sd(data$prem_market))
stats_pure <- c(summary(data$prem_pure)[c(1, 3, 4, 6)], sd(data$prem_pure))
prime_type <- c("Final","Last","Market","Pure", "Index (\\%)")
tableau_stats <- cbind(prime_type ,rbind(round(stats_final, 2), round(stats_last, 2), round(stats_market, 2), round(stats_pure, 2)))
dat_frame_tab <- as.data.frame(tableau_stats)
colnames(dat_frame_tab) <- c("Prime (\\$)", "Minimum", "Médiane", "Moyenne", "Maximum", "Écart-type")
print.tables(dat_frame_tab, digits=2, align = c("l", "l", rep("c",5)))
prem_final <- ggplot(data, aes(y = prem_final, x = lapse, color = polholder_gender)) + geom_boxplot() + facet_grid() + theme_bw()
prem_last <- ggplot(data, aes(y = prem_last, x = lapse, color = polholder_gender)) + geom_boxplot() + facet_grid() + theme_bw()
prem_market <- ggplot(data, aes(y = prem_market, x = lapse, color = polholder_gender)) + geom_boxplot() + facet_grid() + theme_bw()
prem_pure <- ggplot(data, aes(y = prem_pure, x = lapse, color = polholder_gender)) + geom_boxplot() + facet_grid() + theme_bw()
grid.arrange(prem_final, prem_last, prem_market, prem_pure,  ncol=2, nrow = 2)
nb_manquant <- round(apply(data, 2, FUN = function(x) sum(is.na(x)))/nrow(data) * 100,2)
# pattern.matrix <- md.pattern(data, rotate.names = TRUE)
missing.pathern <- aggr(data, combined = TRUE, ylabs="",labels=c("","","","diffdriver","","","","caruse","","","","","","","","","garage","",""), sortVars=TRUE)
test.MCAR <- function(var.data, na_var.data){
# Détermine automatique si la variable est catégorielle ou
# nuérique et utilise le bon test approprié.
if(is.numeric(data[[var.data]])){
round(t.test(data[[var.data]][is.na(data[[na_var.data]])],
data[[var.data]][!is.na(data[[na_var.data]])],var.equal=FALSE)[["p.value"]], 5)
}else{
round(chisq.test(data[[var.data]], is.na(data[[na_var.data]]), correct=FALSE)[["p.value"]], 5)
}
}
# Test pour vehicl_garage
sapply(names(data  %>% select(-vehicl_garage)), FUN=test.MCAR, na_var.data = "vehicl_garage")
# Test pour policy_caruse
sapply(names(data  %>% select(-policy_caruse)), FUN=test.MCAR, na_var.data = "policy_caruse")
# Test pour polholder_diffdriver
sapply(names(data  %>% select(-polholder_diffdriver, -vehicl_garage, -policy_caruse)), FUN=test.MCAR, na_var.data = "polholder_diffdriver")
data <- na.omit(data)
Data_num <- data[, c("polholder_age", "policy_age", "policy_nbcontract", "prem_final", "prem_last", "prem_market",
"prem_pure", "vehicl_age", "vehicl_agepurchase")]
ACP <- PCA(Data_num, scale = TRUE)
fviz_screeplot(ACP)
contrib <- data.frame(ACP$var$coord[,1:2])
contrib$carac <- rownames(contrib)
contrib.long <- reshape2::melt(contrib)
ggplot(contrib.long, aes(x=carac, fill=variable, y=value))+
geom_bar(stat="identity",position=PositionDodge)+
facet_grid(~variable)+
theme(legend.position="top",axis.text.x = element_text(angle = 90))+
xlab("Variable") +
ylab("Poids") +
coord_flip()
ACP <- PCA(Data_num, scale = TRUE)
contrib.gg <- data.frame(ACP$var$coord[,1:2], data$lapse)
contrib.gg <- cbind(data.frame(ACP$var$coord[,1:2]), data$lapse)
ACP$var$coord[,1:2]
contrib.gg <- cbind(data.frame(ACP$ind$coord[,1:2]), data$lapse)
contrib.gg
ggplot(contrib.gg, aes(x=Dim.1, y=Dim.2, col=lapse))
ggplot(contrib.gg, aes(x=Dim.1, y=Dim.2, col=lapse)) + geom_point()
contrib.gg
ggplot(contrib.gg, aes(x=Dim.1, y=Dim.2, col=data$lapse)) + geom_point()
ggplot(contrib.gg, aes(x=Dim.1, y=Dim.2, shape=data$prem_index)) + geom_point()
class(data$prem_index)
ggplot(contrib.gg, aes(x=Dim.1, y=Dim.2, shape=data$prem_index)) + geom_point()
ggplot(contrib.gg, aes(x=Dim.1, y=Dim.2, size=data$prem_index)) + geom_point()
ggplot(contrib.gg, aes(x=Dim.1, y=Dim.2, size=data$prem_index)) + geom_point(alpha=0.1)
ggplot(contrib.gg, aes(x=Dim.1, y=Dim.2, size=data$prem_index)) + geom_point(alpha=0.2)
agepurchase_vehicule <- ggplot(data, aes(x = vehicl_agepurchase))+
geom_bar() + theme_bw() + ggtitle("(1)") + xlab("Âge è l'achat") + ylab("Fréquence")
age_vehicule <- ggplot(data, aes(x = vehicl_age))+
geom_bar()+ theme_bw() + ggtitle("(2)") + xlab("Âge du véhicule") + ylab("Fréquence")
grid.arrange(agepurchase_vehicule, age_vehicule,  ncol=2)
agepurchase_vehicule <- ggplot(data, aes(x = vehicl_agepurchase))+
geom_bar() + theme_bw() + ggtitle("(1)") + xlab("Âge à l'achat") + ylab("Fréquence")
age_vehicule <- ggplot(data, aes(x = vehicl_age))+
geom_bar()+ theme_bw() + ggtitle("(2)") + xlab("Âge du véhicule") + ylab("Fréquence")
grid.arrange(agepurchase_vehicule, age_vehicule,  ncol=2)
